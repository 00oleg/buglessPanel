function CMD(e,n){this.element=e,this.threshold=n.threshold||20,this.preventScroll=n.preventScroll||!1,this.innerElement=n.innerElement,this.startX=null,this.startY=null,this.initListeners()}function Panel(e,n){var t=this;if(BuglessPanels.panels.push(t),t.element=document.querySelector(e),t.innerElement=t.element.querySelector(".inner"),t.transitionEvent=Help.transitionEvent(),t.x=null,t.y=null,t.isOpened=!1,t.onShow=n.onShow||null,t.onShown=n.onShown||null,t.onClose=n.onClose||null,t.onClosed=n.onClosed||null,!t.element)throw new Error('Panel "'+e+'" not found');if(!n.position)throw new Error("Please specify the panel position");if(t.position=n.position,n.closeBySwipe!==!1)switch(t.elementCMD=new CMD(t.element,{threshold:BuglessPanels.moveThreshold,preventScroll:!0,innerElement:t.innerElement}),t.position){case Panel.POSITION_LEFT:t.x=-100,t.y=0,t.listenLeftSwipe();break;case Panel.POSITION_RIGHT:t.x=100,t.y=0,t.listenRightSwipe();break;case Panel.POSITION_TOP:t.x=0,t.y=-100,t.listenTopSwipe();break;case Panel.POSITION_BOTTOM:t.x=0,t.y=100,t.listenBottomSwipe()}}CMD.prototype.initListeners=function(){var e=this,n=!1,t=!1,o={direction:null,touches:null,deltaX:null,deltaY:null};e.element.addEventListener("touchstart",function(n){e.startX=n.touches[0].clientX,e.startY=n.touches[0].clientY},!1),e.element.addEventListener("touchmove",function(l){var s=l.touches[0].clientX-e.startX,i=l.touches[0].clientY-e.startY,a=Math.abs(s)>0,r=Math.abs(i)>0;o={touches:l.touches,deltaX:s,deltaY:i,direction:n},e.preventScroll&&(i>0&&e.element.scrollTop<=0&&l.preventDefault(),e.innerElement&&0>i&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight&&l.preventDefault()),n===!1?(Math.abs(s)>e.threshold&&(n=s>0?"right":"left",t="horizontal"),Math.abs(i)>e.threshold&&(n=i>0?"bottom":"top",t="vertical"),a&&(s>0?e.triggerEvent("moveright",o):0>s&&e.triggerEvent("moveleft",o)),r&&(i>0?e.triggerEvent("movebottom",o):0>i&&e.triggerEvent("movetop",o))):(("horizontal"==t&&r||"vertical"==t&&a)&&l.preventDefault(),e.triggerEvent("move"+n,o))},!1),e.element.addEventListener("touchend",function(){e.triggerEvent("moveend"+n,o),n=!1},!1),e.element.addEventListener("touchcancel",function(){e.triggerEvent("moveend"+n,o),n=!1},!1)},CMD.prototype.triggerEvent=function(e,n){var t=document.createEvent("Event");t.initEvent(e,!0,!0);for(var o in n)t[o]=n[o];this.element.dispatchEvent(t)},CMD.prototype.on=function(e,n){this.element.addEventListener(e,n,!1)};var BuglessPanels={moveThreshold:20,panelThreshold:40,panels:[],init:function(e){if(this.params=e,!e.content)throw new Error('"content" parameter was not passed');if(this.content=document.querySelector(e.content),!this.content)throw new Error("Content element not found");if(this.moveThreshold=this.params.moveThreshold||20,this.panelThreshold=this.params.panelThreshold||40,e.leftPanel){if(!(e.leftPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.leftPanel=e.leftPanel,this.leftPanel.position=Panel.POSITION_LEFT,this.initContentCMD(),this.listenRightSwipe()}if(e.rightPanel){if(!(e.rightPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.rightPanel=e.rightPanel,this.rightPanel.position=Panel.POSITION_RIGHT,this.initContentCMD(),this.listenLeftSwipe()}},initContentCMD:function(){var e=this;this.contentCMD||(this.contentCMD=new CMD(this.content,{threshold:e.moveThreshold}),this.contentCMD.on("touchstart",function(){e.panelsAnimateOff()}))},listenRightSwipe:function(){var e=this;e.contentCMD.on("moveright",function(n){n.direction!==!1&&(e.leftPanel.onShow&&!e.leftPanel.onShowWasCalled&&(e.leftPanel.onShow(e.leftPanel),e.leftPanel.onShowWasCalled=!0),e.leftPanel.show(),e.leftPanel.moveX(Help.calculatePercentageX(n.touches[0].clientX)))}),e.contentCMD.on("moveendright",function(){e.leftPanel.x>e.panelThreshold?e.leftPanel.open():e.leftPanel.close(),e.leftPanel.onShowWasCalled=!1})},listenLeftSwipe:function(){var e=this;e.contentCMD.on("moveleft",function(n){n.direction!==!1&&(e.rightPanel.onShow&&!e.rightPanel.onShowWasCalled&&(e.rightPanel.onShow(e.rightPanel),e.rightPanel.onShowWasCalled=!0),e.rightPanel.show(),e.rightPanel.moveX(Help.calculatePercentageX(n.touches[0].clientX)))}),e.contentCMD.on("moveendleft",function(){e.rightPanel.x<100-e.panelThreshold?e.rightPanel.open():e.rightPanel.close(),e.rightPanel.onShowWasCalled=!1})},panelsAnimateOff:function(){for(var e in this.panels)this.panels[e].animateOff()},closeAll:function(){for(var e in this.panels)this.panels[e].isOpened&&this.panels[e].close()}};Panel.POSITION_LEFT=1,Panel.POSITION_RIGHT=2,Panel.POSITION_TOP=4,Panel.POSITION_BOTTOM=6,Panel.prototype.listenTopSwipe=function(){var e=this,n=null;e.elementCMD.on("touchstart",function(t){e.animateOff(),n=screen.height-t.touches[0].clientY}),e.elementCMD.on("movetop",function(t){if(t.direction!==!1&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageY(t.touches[0].clientY)+Help.calculatePercentageY(n);e.moveY(100>o?o:100)}}),e.elementCMD.on("moveendtop",function(){e.onCloseWasCalled=!1,e.y<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenBottomSwipe=function(){var e=this,n=null;e.elementCMD.on("touchstart",function(t){e.animateOff(),n=t.touches[0].clientY}),e.elementCMD.on("movebottom",function(t){if(t.direction!==!1&&e.element.scrollTop<=0){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageY(t.touches[0].clientY)-Help.calculatePercentageY(n);e.moveY(o>0?o:0)}}),e.elementCMD.on("moveendbottom",function(){e.onCloseWasCalled=!1,e.y>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenLeftSwipe=function(){var e=this,n=null;e.elementCMD.on("touchstart",function(t){e.animateOff(),n=screen.width-t.touches[0].clientX}),e.elementCMD.on("moveleft",function(t){if(t.direction!==!1){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageX(t.touches[0].clientX)+Help.calculatePercentageX(n);e.moveX(100>o?o:100)}}),e.elementCMD.on("moveendleft",function(){e.onCloseWasCalled=!1,e.x<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenRightSwipe=function(){var e=this,n=null;e.elementCMD.on("touchstart",function(t){e.animateOff(),n=t.touches[0].clientX}),e.elementCMD.on("moveright",function(t){if(t.direction!==!1){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageX(t.touches[0].clientX)-Help.calculatePercentageX(n);e.moveX(o>0?o:0)}}),e.elementCMD.on("moveendright",function(){e.onCloseWasCalled=!1,e.x>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.animateOff=function(){Help.removeClass(this.element,"animate")},Panel.prototype.show=function(){this.element.style.display="block"},Panel.prototype.hide=function(){this.element.style.display="none"},Panel.prototype.moveX=function(e){this.x=e,e=this.position==Panel.POSITION_LEFT?-100+e:e,this.element.style.transform="translateX("+e+"%)"},Panel.prototype.moveY=function(e){this.y=e,e=this.position==Panel.POSITION_TOP?-100+e:e,this.element.style.transform="translateY("+e+"%)"},Panel.prototype.close=function(){function e(){n.hide(),n.onClosed&&n.onClosed(n),n.element.removeEventListener(n.transitionEvent,e),n.isOpened=!1}var n=this;switch(Help.addClass(this.element,"animate"),this.position){case Panel.POSITION_LEFT:this.moveX(0);break;case Panel.POSITION_RIGHT:this.moveX(100);break;case Panel.POSITION_TOP:this.moveY(0);break;case Panel.POSITION_BOTTOM:this.moveY(100)}n.transitionEvent&&(n.element.removeEventListener(n.transitionEvent,e),n.element.addEventListener(n.transitionEvent,e))},Panel.prototype.open=function(){var e=this;!e.onShow||e.isOpened||e.onShowWasCalled||e.onShow(e),e.show();var n=setInterval(function(){function t(){e.element.removeEventListener(e.transitionEvent,t),e.onShown&&!e.isOpened&&e.onShown(e),e.isOpened=!0}if("block"==e.element.style.display){switch(Help.addClass(e.element,"animate"),e.position){case Panel.POSITION_LEFT:e.moveX(100);break;case Panel.POSITION_RIGHT:e.moveX(0);break;case Panel.POSITION_TOP:e.moveY(100);break;case Panel.POSITION_BOTTOM:e.moveY(0)}clearInterval(n),e.transitionEvent&&(e.element.removeEventListener(e.transitionEvent,t),e.element.addEventListener(e.transitionEvent,t))}},50)};var Help={calculatePercentageX:function(e){return 100*e/screen.width},calculatePercentageY:function(e){return 100*e/screen.height},hasClass:function(e,n){return e.classList?e.classList.contains(n):!!e.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))},addClass:function(e,n){e.classList?e.classList.add(n):hasClass(e,n)||(e.className+=" "+n)},removeClass:function(e,n){if(e.classList)e.classList.remove(n);else if(hasClass(e,n)){var t=new RegExp("(\\s|^)"+n+"(\\s|$)");e.className=e.className.replace(t," ")}},transitionEvent:function(){var e,n=document.createElement("fakeelement"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(void 0!==n.style[e])return t[e]}};
//# sourceMappingURL=bugless-panel.min.js.map

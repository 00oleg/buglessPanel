function CMD(e,t){this.element=e,this.threshold=t.threshold||20,this.preventScroll=t.preventScroll||!1,this.innerElement=t.innerElement,this.startX=null,this.startY=null,this.initListeners()}function Panel(e,t){var n=this;if(BuglessPanels.panels.push(n),n.element=document.querySelector(e),n.innerElement=n.element.querySelector(".inner"),n.transitionEvent=Help.transitionEvent(),n.x=null,n.y=null,n.isOpened=!1,n.onShow=t.onShow||null,n.onShown=t.onShown||null,n.onClose=t.onClose||null,n.onClosed=t.onClosed||null,!n.element)throw new Error('Panel "'+e+'" not found');if(!t.position)throw new Error("Please specify the panel position");if(n.position=t.position,t.closeBySwipe!==!1)switch(n.elementCMD=new CMD(n.element,{threshold:BuglessPanels.moveThreshold,preventScroll:!0,innerElement:n.innerElement}),n.position){case Panel.POSITION_LEFT:n.x=-100,n.y=0,n.listenLeftSwipe();break;case Panel.POSITION_RIGHT:n.x=100,n.y=0,n.listenRightSwipe();break;case Panel.POSITION_TOP:n.x=0,n.y=-100,n.listenTopSwipe();break;case Panel.POSITION_BOTTOM:n.x=0,n.y=100,n.listenBottomSwipe()}}CMD.prototype.initListeners=function(){var e=this,t=!1,n=!1,o={direction:null,touches:null,deltaX:null,deltaY:null};e.element.addEventListener("touchstart",function(t){e.startX=t.touches[0].clientX,e.startY=t.touches[0].clientY},!1),e.element.addEventListener("touchmove",function(l){var i=l.touches[0].clientX-e.startX,s=l.touches[0].clientY-e.startY,a=Math.abs(i)>0,r=Math.abs(s)>0;o={touches:l.touches,deltaX:i,deltaY:s,direction:t},e.preventScroll&&(s>0&&e.element.scrollTop<=0&&l.preventDefault(),e.innerElement&&0>s&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight&&l.preventDefault()),t===!1?(Math.abs(i)>e.threshold&&(t=i>0?"right":"left",n="horizontal"),Math.abs(s)>e.threshold&&(t=s>0?"bottom":"top",n="vertical"),a&&(i>0?e.triggerEvent("moveright",o):0>i&&e.triggerEvent("moveleft",o)),r&&(s>0?e.triggerEvent("movebottom",o):0>s&&e.triggerEvent("movetop",o))):(("horizontal"==n&&r||"vertical"==n&&a)&&l.preventDefault(),e.triggerEvent("move"+t,o))},!1),e.element.addEventListener("touchend",function(){e.triggerEvent("moveend"+t,o),t=!1},!1),e.element.addEventListener("touchcancel",function(){e.triggerEvent("moveend"+t,o),t=!1},!1)},CMD.prototype.triggerEvent=function(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0);for(var o in t)n[o]=t[o];this.element.dispatchEvent(n)},CMD.prototype.on=function(e,t){this.element.addEventListener(e,t,!1)};var BuglessPanels={moveThreshold:20,panelThreshold:40,panels:[],init:function(e){if(this.params=e,!e.content)throw new Error('"content" parameter was not passed');if(this.content=document.querySelector(e.content),!this.content)throw new Error("Content element not found");if(this.moveThreshold=this.params.moveThreshold||20,this.panelThreshold=this.params.panelThreshold||40,e.leftPanel){if(!(e.leftPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.leftPanel=e.leftPanel,this.leftPanel.position=Panel.POSITION_LEFT,this.initContentCMD(),this.listenRightSwipe()}if(e.rightPanel){if(!(e.rightPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.rightPanel=e.rightPanel,this.rightPanel.position=Panel.POSITION_RIGHT,this.initContentCMD(),this.listenLeftSwipe()}},initContentCMD:function(){var e=this;this.contentCMD||(this.contentCMD=new CMD(this.content,{threshold:e.moveThreshold}),this.contentCMD.on("touchstart",function(){e.panelsAnimateOff()}))},listenRightSwipe:function(){var e=this;e.contentCMD.on("moveright",function(t){t.direction!==!1&&(e.leftPanel.onShow&&!e.leftPanel.onShowWasCalled&&(e.leftPanel.onShow(e.leftPanel),e.leftPanel.onShowWasCalled=!0),e.leftPanel.show(),e.leftPanel.moveX(Help.calculatePercentageX(t.touches[0].clientX)))}),e.contentCMD.on("moveendright",function(){e.leftPanel.onShowWasCalled=!1,e.leftPanel.x>e.panelThreshold?e.leftPanel.open():e.leftPanel.close()})},listenLeftSwipe:function(){var e=this;e.contentCMD.on("moveleft",function(t){t.direction!==!1&&(e.rightPanel.onShow&&!e.rightPanel.onShowWasCalled&&(e.rightPanel.onShow(e.rightPanel),e.rightPanel.onShowWasCalled=!0),e.rightPanel.show(),e.rightPanel.moveX(Help.calculatePercentageX(t.touches[0].clientX)))}),e.contentCMD.on("moveendleft",function(){e.rightPanel.x<100-e.panelThreshold?e.rightPanel.open():e.rightPanel.close()})},panelsAnimateOff:function(){for(var e in this.panels)this.panels[e].animateOff()}};Panel.POSITION_LEFT=1,Panel.POSITION_RIGHT=2,Panel.POSITION_TOP=4,Panel.POSITION_BOTTOM=6,Panel.prototype.listenTopSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=screen.height-n.touches[0].clientY}),e.elementCMD.on("movetop",function(n){if(n.direction!==!1&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight){e.onCloseWasCalled||(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageY(n.touches[0].clientY)+Help.calculatePercentageY(t);e.moveY(100>o?o:100)}}),e.elementCMD.on("moveendtop",function(){e.onCloseWasCalled=!1,e.y<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenBottomSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=n.touches[0].clientY}),e.elementCMD.on("movebottom",function(n){if(n.direction!==!1&&e.element.scrollTop<=0){e.onCloseWasCalled||(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageY(n.touches[0].clientY)-Help.calculatePercentageY(t);e.moveY(o>0?o:0)}}),e.elementCMD.on("moveendbottom",function(){e.onCloseWasCalled=!1,e.y>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenLeftSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=screen.width-n.touches[0].clientX}),e.elementCMD.on("moveleft",function(n){if(n.direction!==!1){e.onCloseWasCalled||(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageX(n.touches[0].clientX)+Help.calculatePercentageX(t);e.moveX(100>o?o:100)}}),e.elementCMD.on("moveendleft",function(){e.onCloseWasCalled=!1,e.x<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenRightSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=n.touches[0].clientX}),e.elementCMD.on("moveright",function(n){if(n.direction!==!1){e.onCloseWasCalled||(e.onClose(e),e.onCloseWasCalled=!0);var o=Help.calculatePercentageX(n.touches[0].clientX)-Help.calculatePercentageX(t);e.moveX(o>0?o:0)}}),e.elementCMD.on("moveendright",function(){e.onCloseWasCalled=!1,e.x>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.animateOff=function(){Help.removeClass(this.element,"animate")},Panel.prototype.show=function(){this.element.style.display="block"},Panel.prototype.hide=function(){this.element.style.display="none"},Panel.prototype.moveX=function(e){this.x=e,e=this.position==Panel.POSITION_LEFT?-100+e:e,this.element.style.transform="translateX("+e+"%)"},Panel.prototype.moveY=function(e){this.y=e,e=this.position==Panel.POSITION_TOP?-100+e:e,this.element.style.transform="translateY("+e+"%)"},Panel.prototype.close=function(){function e(){t.hide(),t.onClosed&&t.onClosed(t),t.element.removeEventListener(t.transitionEvent,e),t.isOpened=!1}var t=this;switch(Help.addClass(this.element,"animate"),this.position){case Panel.POSITION_LEFT:this.moveX(0);break;case Panel.POSITION_RIGHT:this.moveX(100);break;case Panel.POSITION_TOP:this.moveY(0);break;case Panel.POSITION_BOTTOM:this.moveY(100)}t.transitionEvent&&(t.element.removeEventListener(t.transitionEvent,e),t.element.addEventListener(t.transitionEvent,e))},Panel.prototype.open=function(){var e=this;e.onShow&&!e.isOpened&&e.onShow(e),e.show();var t=setInterval(function(){function n(){e.element.removeEventListener(e.transitionEvent,n),e.onShown(e),e.isOpened=!0}if("block"==e.element.style.display){switch(Help.addClass(e.element,"animate"),e.position){case Panel.POSITION_LEFT:e.moveX(100);break;case Panel.POSITION_RIGHT:e.moveX(0);break;case Panel.POSITION_TOP:e.moveY(100);break;case Panel.POSITION_BOTTOM:e.moveY(0)}clearInterval(t),e.onShown&&e.transitionEvent&&(e.element.removeEventListener(e.transitionEvent,n),e.element.addEventListener(e.transitionEvent,n))}},50)};var Help={calculatePercentageX:function(e){return 100*e/screen.width},calculatePercentageY:function(e){return 100*e/screen.height},hasClass:function(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){e.classList?e.classList.add(t):hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(e.classList)e.classList.remove(t);else if(hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},transitionEvent:function(){var e,t=document.createElement("fakeelement"),n={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}};
//# sourceMappingURL=bugless-panel.min.js.map

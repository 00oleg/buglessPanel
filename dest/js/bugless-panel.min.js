function CMD(e,t){this.element=e,this.threshold=t.threshold||20,this.preventScroll=t.preventScroll||!1,this.innerElement=t.innerElement,this.startX=null,this.startY=null,this.initListeners()}function Panel(e,t){var n=this;if(n.element=document.querySelector(e),n.innerElement=n.element.querySelector(".inner"),n.x=null,n.y=null,n.isOpened=!1,!n.element)throw new Error('Panel "'+e+'" not found');if(!n.innerElement)throw new Error("Panel inner not found");if(!t.position)throw new Error("Please specify the panel position");if(n.onShow=t.onShow||null,n.onShown=t.onShown||null,n.onClose=t.onClose||null,n.onClosed=t.onClosed||null,n.position=t.position,n.width=n.w=t.width||100,n.height=t.height||100,n.maxWidth=t.maxWidth||null,BuglessPanels.panels.push(n),n.applyPanelSizes(),n.innerElement.querySelectorAll('input[type="text"], select').length){var l=n.innerElement.querySelectorAll('input[type="text"], select'),o=document.createElement("div");o.className="iosfix";for(var i=0;i<l.length;i++)l[i].addEventListener("focusout",function(){n.innerElement.appendChild(o),setTimeout(function(){n.innerElement.querySelector(".iosfix").remove()},500)})}if(window.addEventListener("resize",function(){setTimeout(function(){n.applyPanelSizes()},100)},!1),t.closeBySwipe!==!1)switch(n.elementCMD=new CMD(n.element,{threshold:BuglessPanels.moveThreshold,preventScroll:!0,innerElement:n.innerElement}),n.position){case Panel.POSITION_LEFT:n.x=-100,n.y=0,n.listenLeftSwipe();break;case Panel.POSITION_RIGHT:n.x=100,n.y=0,n.listenRightSwipe();break;case Panel.POSITION_TOP:n.x=0,n.y=-100,n.listenTopSwipe();break;case Panel.POSITION_BOTTOM:n.x=0,n.y=100,n.listenBottomSwipe()}}CMD.prototype.initListeners=function(){var e=this,t=!1,n=!1,l={direction:null,touches:null,deltaX:null,deltaY:null};e.element.addEventListener("touchstart",function(t){e.startX=t.touches[0].clientX,e.startY=t.touches[0].clientY},!1),e.element.addEventListener("touchmove",function(o){var i=o.touches[0].clientX-e.startX,a=o.touches[0].clientY-e.startY,s=Math.abs(i)>0,c=Math.abs(a)>0;l={touches:o.touches,deltaX:i,deltaY:a,direction:t},e.preventScroll&&(a>0&&e.element.scrollTop<=0&&o.preventDefault(),e.innerElement&&0>a&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight&&o.preventDefault()),t===!1?(Math.abs(i)>e.threshold&&(t=i>0?"right":"left",n="horizontal"),Math.abs(a)>e.threshold&&(t=a>0?"bottom":"top",n="vertical"),s&&(i>0?e.triggerEvent("moveright",l):0>i&&e.triggerEvent("moveleft",l)),c&&(a>0?e.triggerEvent("movebottom",l):0>a&&e.triggerEvent("movetop",l))):(("horizontal"==n&&c||"vertical"==n&&s)&&o.preventDefault(),e.triggerEvent("move"+t,l))},!1),e.element.addEventListener("touchend",function(){e.triggerEvent("moveend"+t,l),t=!1},!1),e.element.addEventListener("touchcancel",function(){e.triggerEvent("moveend"+t,l),t=!1},!1)},CMD.prototype.triggerEvent=function(e,t){var n=document.createEvent("Event");n.initEvent(e,!0,!0);for(var l in t)n[l]=t[l];this.element.dispatchEvent(n)},CMD.prototype.on=function(e,t){this.element.addEventListener(e,t,!1)};var BuglessPanels={moveThreshold:20,panelThreshold:40,panels:[],activePanel:null,exceptions:[],_startTarget:null,init:function(e){if(this.params=e,!e.content)throw new Error('"content" parameter was not passed');if(this.content=e.content,this.contentElement=document.querySelector(e.content),!this.contentElement)throw new Error("Content element not found");if(this.moveThreshold=this.params.moveThreshold||20,this.panelThreshold=this.params.panelThreshold||40,this.exceptions=this.params.exceptions||[],e.leftPanel){if(!(e.leftPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.leftPanel=e.leftPanel,this.leftPanel.position=Panel.POSITION_LEFT,this.initContentCMD(),this.listenRightSwipe()}if(e.rightPanel){if(!(e.rightPanel instanceof Panel))throw new Error('"leftPanel" parameter must be an instance of Panel');this.rightPanel=e.rightPanel,this.rightPanel.position=Panel.POSITION_RIGHT,this.initContentCMD(),this.listenLeftSwipe()}this.initBackdrop()},initBackdrop:function(){var e=this;if(this.backdrop=document.querySelector(".bugless-backdrop"),null==this.backdrop){this.backdrop=document.createElement("div"),this.backdrop.setAttribute("class","bugless-backdrop"),document.body.appendChild(this.backdrop);var t=null,n=null;this.backdrop.addEventListener("touchstart",function(l){t=l.touches[0].clientX,n=l.touches[0].clientY,e.activePanel.animateOff()}),this.backdrop.addEventListener("touchmove",function(t){if(e.activePanel.position==Panel.POSITION_LEFT||e.activePanel.position==Panel.POSITION_RIGHT){n!=t.touches[0].clientY&&t.preventDefault();var l=Help.calculatePercentageX(t.touches[0].clientX),o=100*l/e.activePanel.width}if(e.activePanel.position==Panel.POSITION_TOP||e.activePanel.position==Panel.POSITION_BOTTOM){t.preventDefault();var i=Help.calculatePercentageY(t.touches[0].clientY),a=100*i/e.activePanel.height}e.activePanel.position==Panel.POSITION_TOP&&i<=e.activePanel.height&&e.activePanel.moveY(a),e.activePanel.position==Panel.POSITION_BOTTOM&&i>=100-e.activePanel.height&&e.activePanel.moveY(a-100*(100-e.activePanel.height)/e.activePanel.height),e.activePanel.position==Panel.POSITION_LEFT&&l<=e.activePanel.width&&e.activePanel.moveX(o),e.activePanel.position==Panel.POSITION_RIGHT&&l>=100-e.activePanel.width&&e.activePanel.moveX(o-100*(100-e.activePanel.width)/e.activePanel.width)},!1),this.backdrop.addEventListener("touchend",function(l){return t<l.changedTouches[0].clientX+5&&t>l.changedTouches[0].clientX-5&&n<l.changedTouches[0].clientY+5&&n>l.changedTouches[0].clientY-5?e.closeAll():(e.activePanel&&e.activePanel.position==Panel.POSITION_TOP&&(100-e.activePanel.y<e.panelThreshold?e.activePanel.open():e.activePanel.close()),e.activePanel&&e.activePanel.position==Panel.POSITION_BOTTOM&&(e.activePanel.y<e.panelThreshold?e.activePanel.open():e.activePanel.close()),e.activePanel&&e.activePanel.position==Panel.POSITION_LEFT&&(100-e.activePanel.x<e.panelThreshold?e.activePanel.open():e.activePanel.close()),void(e.activePanel&&e.activePanel.position==Panel.POSITION_RIGHT&&(e.activePanel.x<e.panelThreshold?e.activePanel.open():e.activePanel.close())))})}},initContentCMD:function(){var e=this;this.contentCMD||(this.contentCMD=new CMD(this.contentElement,{threshold:e.moveThreshold}),this.contentCMD.on("touchstart",function(){e.panelsAnimateOff()}))},isException:function(e){var t=this,n=t.exceptions.length;if(0===n)return!1;for(var l=0;n>l;l++)if(Help.closest(e,t.exceptions[l])||e==document.querySelector(t.exceptions[l]))return!0;return!1},listenRightSwipe:function(){var e=this,t=null,n=!1;e.contentCMD.on("touchstart",function(l){e._startTarget=l.target,e.isException(e._startTarget)||(t=Help.calculatePercentageX(l.touches[0].clientX),n=null==Help.closest(l.target,".bugless-panel")&&l.target!=document.querySelector(".bugless-panel"))}),e.contentCMD.on("moveright",function(l){if(!e.isException(e._startTarget)&&l.direction!==!1&&n){e.leftPanel.onShow&&!e.leftPanel.onShowWasCalled&&(e.leftPanel.onShow(e.leftPanel),e.leftPanel.onShowWasCalled=!0),e.leftPanel.show();var o=Help.calculatePercentageX(l.touches[0].clientX);null!==e.leftPanel.maxWidth&&t>e.leftPanel.width&&(o-=t);var i=100*o/e.leftPanel.width;e.leftPanel.moveX(i)}}),e.contentCMD.on("moveendright",function(){if(!e.isException(e._startTarget)){var t=100*e.leftPanel.x/e.leftPanel.width;t>e.panelThreshold?e.leftPanel.open():e.leftPanel.close(),e.leftPanel.onShowWasCalled=!1,n=!1}})},listenLeftSwipe:function(){var e=this,t=null,n=!1;e.contentCMD.on("touchstart",function(l){e._startTarget=l.target,e.isException(e._startTarget)||(t=Help.calculatePercentageX(Help.screenWidth()-l.touches[0].clientX),n=null==Help.closest(l.target,".bugless-panel")&&l.target!=document.querySelector(".bugless-panel"))}),e.contentCMD.on("moveleft",function(l){if(!e.isException(e._startTarget)&&l.direction!==!1&&n){e.rightPanel.onShow&&!e.rightPanel.onShowWasCalled&&(e.rightPanel.onShow(e.rightPanel),e.rightPanel.onShowWasCalled=!0),e.rightPanel.show();var o=Help.calculatePercentageX(l.touches[0].clientX);null!==e.rightPanel.maxWidth&&t>e.rightPanel.width&&(o+=t);var i=100*o/e.rightPanel.width;e.rightPanel.moveX(i-100*(100-e.rightPanel.width)/e.rightPanel.width)}}),e.contentCMD.on("moveendleft",function(){e.isException(e._startTarget)||(e.rightPanel.x<100-e.panelThreshold?e.rightPanel.open():e.rightPanel.close(),e.rightPanel.onShowWasCalled=!1,n=!1)})},getAnimationTime:function(){var e=0;try{e=1e3*parseFloat(getComputedStyle(document.querySelector(".animate")).transitionDuration)}catch(t){e=200}return e},panelsAnimateOff:function(){for(var e in this.panels)this.panels[e].animateOff()},closeAll:function(){for(var e in this.panels)this.panels[e].isOpened&&this.panels[e].close()},backdropOn:function(){Help.addClass(this.backdrop,"in")},backdropOff:function(){Help.removeClass(this.backdrop,"in")}};Panel.POSITION_LEFT=1,Panel.POSITION_RIGHT=2,Panel.POSITION_TOP=4,Panel.POSITION_BOTTOM=6,Panel.prototype.applyPanelSizes=function(){var e=this;null!==e.maxWidth&&(e.width=Help.screenWidth()*e.w/100>e.maxWidth?100*e.maxWidth/Help.screenWidth():e.w),e.element.style.width=e.width+"%",e.element.style.height=e.height+"%"},Panel.prototype.listenTopSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.height-Help.calculatePercentageY(n.touches[0].clientY)}),e.elementCMD.on("movetop",function(n){if(n.direction!==!1&&e.element.scrollTop+e.element.offsetHeight>=e.innerElement.offsetHeight){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var l=Help.calculatePercentageY(n.touches[0].clientY),o=100*l/e.height;e.moveY(o+t)}}),e.elementCMD.on("moveendtop",function(){e.onCloseWasCalled=!1,e.y<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenBottomSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.height-Help.calculatePercentageY(Help.screenHeight()-n.touches[0].clientY)}),e.elementCMD.on("movebottom",function(n){if(n.direction!==!1&&e.element.scrollTop<=0){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var l=100*Help.calculatePercentageY(n.touches[0].clientY)/e.height;l-=100*(100-e.height)/e.height,e.moveY(l-t)}}),e.elementCMD.on("moveendbottom",function(){e.onCloseWasCalled=!1,e.y>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenLeftSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.width-Help.calculatePercentageX(n.touches[0].clientX)}),e.elementCMD.on("moveleft",function(n){if(n.direction!==!1){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var l=Help.calculatePercentageX(n.touches[0].clientX),o=100*l/e.width;e.moveX(o+t)}}),e.elementCMD.on("moveendleft",function(){e.onCloseWasCalled=!1,e.x<100-BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.listenRightSwipe=function(){var e=this,t=null;e.elementCMD.on("touchstart",function(n){e.animateOff(),t=e.width-Help.calculatePercentageX(Help.screenWidth()-n.touches[0].clientX)}),e.elementCMD.on("moveright",function(n){if(n.direction!==!1){e.onClose&&!e.onCloseWasCalled&&(e.onClose(e),e.onCloseWasCalled=!0);var l=100*Help.calculatePercentageX(n.touches[0].clientX)/e.width;l-=100*(100-e.width)/e.width,e.moveX(l-t)}}),e.elementCMD.on("moveendright",function(){e.onCloseWasCalled=!1,e.x>BuglessPanels.panelThreshold?e.close():e.open()})},Panel.prototype.animateOff=function(){Help.removeClass(this.element,"animate")},Panel.prototype.animateOn=function(){Help.addClass(this.element,"animate")},Panel.prototype.show=function(){BuglessPanels.backdropOn(),this.element.style.display="block"},Panel.prototype.hide=function(){this.element.style.display="none"},Panel.prototype.moveX=function(e){return this.position==Panel.POSITION_LEFT&&e>100?!1:this.position==Panel.POSITION_RIGHT&&0>e?!1:(this.x=e,e=this.position==Panel.POSITION_LEFT?-100+e:e,void(this.element.style.transform="translateX("+e+"%)"))},Panel.prototype.moveY=function(e){return this.position==Panel.POSITION_TOP&&e>100?!1:this.position==Panel.POSITION_BOTTOM&&0>e?!1:(this.y=e,e=this.position==Panel.POSITION_TOP?-100+e:e,void(this.element.style.transform="translateY("+e+"%)"))},Panel.prototype.close=function(){var e=this;switch(BuglessPanels.activePanel=null,e.animateOn(),this.position){case Panel.POSITION_LEFT:this.moveX(0);break;case Panel.POSITION_RIGHT:this.moveX(100);break;case Panel.POSITION_TOP:this.moveY(0);break;case Panel.POSITION_BOTTOM:this.moveY(100)}setTimeout(function(){BuglessPanels.backdropOff(),e.hide(),e.onClosed&&e.onClosed(e),e.isOpened=!1},BuglessPanels.getAnimationTime())},Panel.prototype.open=function(){var e=this;BuglessPanels.activePanel=e,e.show(),!e.onShow||e.isOpened||e.onShowWasCalled||e.onShow(e);var t=setInterval(function(){if("block"==e.element.style.display){switch(clearInterval(t),e.animateOn(),e.position){case Panel.POSITION_LEFT:e.moveX(100);break;case Panel.POSITION_RIGHT:e.moveX(0);break;case Panel.POSITION_TOP:e.moveY(100);break;case Panel.POSITION_BOTTOM:e.moveY(0)}setTimeout(function(){e.onShown&&!e.isOpened&&e.onShown(e),e.isOpened=!0},BuglessPanels.getAnimationTime())}},50)};var Help={screenWidth:function(){return document.documentElement.clientWidth},screenHeight:function(){return document.documentElement.clientHeight},calculatePercentageX:function(e){return 100*e/window.innerWidth},calculatePercentageY:function(e){return 100*e/window.innerHeight},hasClass:function(e,t){return e.classList?e.classList.contains(t):!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},addClass:function(e,t){e.classList?e.classList.add(t):hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){if(e.classList)e.classList.remove(t);else if(hasClass(e,t)){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(n," ")}},closest:function(e,t){var n,l;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]?(n=e,!0):!1});null!==e;){if(l=e.parentElement,null!==l&&l[n](t))return l;e=l}return null}};
//# sourceMappingURL=bugless-panel.min.js.map
